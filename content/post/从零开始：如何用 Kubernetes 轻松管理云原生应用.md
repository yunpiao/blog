---
title: ä»é›¶å¼€å§‹ï¼šå¦‚ä½•ç”¨ Kubernetes è½»æ¾ç®¡ç†äº‘åŸç”Ÿåº”ç”¨
tags:
  - k8s
date: 2025-04-29T10:19:29+08:00
draft: false
toc: true
slug: 20250429101929
categories:
---
## **â€œKubernetes ä¸æ€•ä»é›¶å¼€å§‹ï¼š30 åˆ†é’Ÿæå®šä½ çš„ç¬¬ä¸€ä¸ªäº‘åŸç”Ÿéƒ¨ç½²â€**  
> å¦‚æœä½ ä»æœªæ¥è§¦è¿‡ Kubernetesï¼Œå´æƒ³å¿«é€Ÿä¸Šæ‰‹å®ƒç®¡ç†å®¹å™¨åŒ–åº”ç”¨ï¼Œè¿™ç¯‡æ–‡ç« å°±æ˜¯ä¸ºä½ å†™çš„ã€‚æœ¬æ–‡å°†ç”¨æœ€ç›´è§‚çš„æ­¥éª¤ï¼Œæ•™ä½ å¦‚ä½•åœ¨æœ¬åœ°ç¯å¢ƒæ­å»ºä¸€ä¸ª Kubernetes é›†ç¾¤ï¼Œå¹¶éƒ¨ç½²ä¸€ä¸ªç®€å•çš„ Web åº”ç”¨ã€‚æ— éœ€å¤æ‚é…ç½®ï¼Œåªéœ€ä¸€å°ç”µè„‘å’Œ Docker ç¯å¢ƒå³å¯ã€‚  

---
![image.png](https://img.yunpiao.site/2025/04/e8b629391b08f091c5fcf36ab94bfec9.png)

---

## <a id="prereq"></a>å‰ç½®æ¡ä»¶ ğŸ”§  
âœ… å·²å®‰è£… Docker Desktopï¼ˆå« Kubernetes æ’ä»¶ï¼‰  
âœ… å®‰è£… `kubectl` å‘½ä»¤è¡Œå·¥å…·  
ğŸ‘‰ æ¨èï¼šWindows ç”¨æˆ·å®‰è£… WSL2ï¼ŒMac ç”¨æˆ·å¯ç”¨ Rosetta å…¼å®¹æ¨¡å¼  

---

## <a id="tutorial"></a>Step-by-Step æ•™ç¨‹ ğŸš€  

### Step 1: å¯åŠ¨æœ¬åœ°é›†ç¾¤  
```bash  
minikube start --driver=docker  
```  
ğŸ“Œ **è¾“å‡ºé¢„æœŸ**ï¼š  
```
Kubernetes control-plane is running at https://...
```  

### Step 2: éƒ¨ç½² Nginx ç¤ºä¾‹åº”ç”¨ âœ…  
```yaml  
# deployment.yaml  
apiVersion: apps/v1  
kind: Deployment  
metadata:  
  name: nginx-deployment  
spec:  
  replicas: 2  
  selector:  
    matchLabels:  
      app: nginx  
  template:  
    metadata:  
      labels:  
        app: nginx  
    spec:  
      containers:  
      - name: nginx  
        image: nginx:latest  
        ports:  
        - containerPort: 80  
```  

ğŸ’¡ **è§£é‡Š**ï¼š  
- `replicas: 2` = è‡ªåŠ¨åˆ›å»º 2 ä¸ªç›¸åŒçš„å®¹å™¨ç»„ï¼ˆContainer Groupï¼‰ï¼Œé˜²æ­¢å•ç‚¹æ•…éšœã€‚  
- `containerPort: 80` = å¼€æ”¾ Web è®¿é—®ç«¯å£ï¼Œç±»ä¼¼ä¼ ç»ŸæœåŠ¡å™¨çš„é˜²ç«å¢™è®¾ç½®ã€‚  

### Step 3: æµ‹è¯•è‡ªåŠ¨æ‰©å®¹ ğŸ“ˆ  
```bash  
kubectl autoscale deployment nginx-deployment --cpu-percent=50 --min=1 --max=10  
```  
ğŸ“Š **ç»“æœ**ï¼šå½“ CPU ä½¿ç”¨ç‡è¶…è¿‡ 50%ï¼ŒKubernetes ä¼šè‡ªåŠ¨å¢åŠ å®¹å™¨æ•°é‡ï¼Œåƒå¤–å–å¹³å°æ ¹æ®è®¢å•é‡åŠ¨æ€è°ƒé…éª‘æ‰‹ä¸€æ ·ï¼  

---

## <a id="troubleshoot"></a>å¸¸è§é”™è¯¯æ’æŸ¥ âŒ  

| é”™è¯¯ä¿¡æ¯ | åŸå›  | è§£å†³æ–¹æ¡ˆ |  
|---------|------|----------|  
| `CrashLoopBackOff` | å®¹å™¨å¯åŠ¨åç«‹å³å´©æºƒ | æ£€æŸ¥é•œåƒåç§°æ˜¯å¦æ‹¼å†™é”™è¯¯ï¼ˆå¦‚ `nginx:lates` â†’ `nginx:latest`ï¼‰ |  
| `ImagePullBackOff` | æ— æ³•ä¸‹è½½é•œåƒ | åˆ‡æ¢åˆ°å›½å†…é•œåƒä»“åº“ï¼ˆå¦‚é˜¿é‡Œäº‘ registry.aliyuncs.com/google_containersï¼‰ |  

---

## <a id="next"></a>ä¸‹ä¸€æ­¥å­¦ä¹ å»ºè®® ğŸ“š  
- **å®æˆ˜é¡¹ç›®**ï¼šå°è¯•ç”¨ Helm Chart éƒ¨ç½² WordPressï¼ˆé™„[å®˜æ–¹æ–‡æ¡£é“¾æ¥](https://helm.sh/docs/)ï¼‰  
- **æ·±å…¥åŸç†**ï¼šé˜…è¯»ã€ŠKubernetes è®¾è®¡æ¨¡å¼ã€‹


## **Docker Compose vs Kubernetes éƒ¨ç½²æ–¹å¼ä¼˜ç¼ºç‚¹å¯¹æ¯”**

| **ç»´åº¦**                | **Docker Compose**                                                                 | **Kubernetes (K8s)**                                                                 |
|-------------------------|-----------------------------------------------------------------------------------|-------------------------------------------------------------------------------------|
| **é€‚ç”¨åœºæ™¯**            | å•æœº/æœ¬åœ°å¼€å‘ã€å°å‹é¡¹ç›®ã€å¿«é€ŸåŸå‹éªŒè¯                                             | åˆ†å¸ƒå¼ç³»ç»Ÿã€ç”Ÿäº§ç¯å¢ƒã€å¤§è§„æ¨¡å¾®æœåŠ¡é›†ç¾¤                                               |
| **å­¦ä¹ æ›²çº¿**            | âœ… ç®€å•ç›´è§‚ï¼šYAML æ–‡ä»¶å®šä¹‰æœåŠ¡ä¾èµ–å…³ç³»ï¼Œæ— éœ€æŒæ¡å¤æ‚æ¦‚å¿µ                           | âŒ å¤æ‚é™¡å³­ï¼šéœ€ç†è§£ Podã€Serviceã€Deploymentã€Ingress ç­‰èµ„æºå¯¹è±¡                      |
| **éƒ¨ç½²å¤æ‚åº¦**          | âœ… è½»é‡çº§ï¼šå•èŠ‚ç‚¹éƒ¨ç½²ï¼Œ`docker-compose up` ä¸€é”®å¯åŠ¨                                | âŒ é‡é‡çº§ï¼šéœ€æ­å»ºé›†ç¾¤ï¼ˆMinikube/kopsï¼‰ã€é…ç½®ç½‘ç»œå­˜å‚¨ï¼ˆCNI/CRIï¼‰                       |
| **è‡ªåŠ¨åŒ–èƒ½åŠ›**          | âŒ åŸºç¡€åŠŸèƒ½ï¼šä»…æ”¯æŒé‡å¯ç­–ç•¥ï¼ˆrestart: alwaysï¼‰ï¼Œæ— è‡ªåŠ¨æ‰©å®¹/è´Ÿè½½å‡è¡¡                 | âœ… å¼ºå¤§è‡ªåŠ¨åŒ–ï¼šå†…ç½® HPAï¼ˆHorizontal Pod Autoscalerï¼‰ã€æ»šåŠ¨æ›´æ–°ã€è‡ªæˆ‘ä¿®å¤æœºåˆ¶           |
| **èµ„æºåˆ©ç”¨ç‡**          | âŒ å›ºå®šåˆ†é…ï¼šæ— æ³•åŠ¨æ€è°ƒåº¦å®¹å™¨åˆ°ä¸åŒä¸»æœºï¼Œèµ„æºåˆ©ç”¨ç‡ä½                               | âœ… æ™ºèƒ½è°ƒåº¦ï¼šåŸºäºèµ„æºè¯·æ±‚ï¼ˆCPU/Memoryï¼‰åŠ¨æ€åˆ†é… Pod åˆ°æœ€ä¼˜èŠ‚ç‚¹                        |
| **ç½‘ç»œä¸å­˜å‚¨ç®¡ç†**      | âœ… ç®€å•ç½‘ç»œï¼šé»˜è®¤æ¡¥æ¥ç½‘ç»œï¼Œæ‰‹åŠ¨é…ç½®ç«¯å£æ˜ å°„                                       | âœ… çµæ´»ç½‘ç»œï¼šé€šè¿‡ CNI æ’ä»¶å®ç°è·¨èŠ‚ç‚¹é€šä¿¡ï¼›æ”¯æŒæŒä¹…åŒ–å·ï¼ˆPV/PVCï¼‰åŠ¨æ€ä¾›ç»™               |
| **æœåŠ¡å‘ç°ä¸è´Ÿè½½å‡è¡¡**  | âŒ æœ‰é™æ”¯æŒï¼šä¾èµ– Docker å†…éƒ¨ DNSï¼Œéœ€æ‰‹åŠ¨é…ç½®åå‘ä»£ç†ï¼ˆå¦‚ Nginxï¼‰                  | âœ… å†…ç½®æœåŠ¡ç½‘æ ¼ï¼šé€šè¿‡ Service å’Œ Ingress å®ç°è‡ªåŠ¨æœåŠ¡å‘ç°ä¸è´Ÿè½½å‡è¡¡                    |
| **å®‰å…¨æ€§**              | âŒ åŸºç¡€éš”ç¦»ï¼šä¾èµ– Docker å®‰å…¨ç­–ç•¥ï¼Œç¼ºä¹ç»†ç²’åº¦æƒé™æ§åˆ¶ï¼ˆRBACï¼‰                      | âœ… é«˜çº§å®‰å…¨ï¼šæ”¯æŒå‘½åç©ºé—´éš”ç¦»ã€RBACã€Network Policiesã€Secret åŠ å¯†                     |
| **ç»´æŠ¤ä¸è°ƒè¯•**          | âœ… å¿«é€Ÿè¿­ä»£ï¼šä¿®æ”¹ `docker-compose.yml` åé‡å¯æœåŠ¡å³å¯                              | âŒ å¤æ‚è°ƒè¯•ï¼šéœ€ç†Ÿæ‚‰ `kubectl logs/describe/exec` åŠç›‘æ§å·¥å…·ï¼ˆPrometheus/Grafanaï¼‰       |
| **ç¤¾åŒºä¸ç”Ÿæ€**          | âœ… æˆç†Ÿç¨³å®šï¼šDocker ç”Ÿæ€å¹¿æ³›ï¼Œæ–‡æ¡£ä¸°å¯Œï¼Œæ’ä»¶ä¼—å¤šï¼ˆå¦‚ Portainer ç®¡ç†ç•Œé¢ï¼‰           | âœ… æ´»è·ƒç”Ÿæ€ï¼šCNCF ä¸»å¯¼ï¼ŒHelm Chartsã€Operator Frameworkã€Service Meshï¼ˆIstio/Linkerdï¼‰ç­‰ |
| **å…¸å‹å‘½ä»¤å¯¹æ¯”**        | ```bash<br>docker-compose up -d<br>docker-compose down<br>```                     | ```bash<br>kubectl apply -f deployment.yaml<br>kubectl get pods,services,deployments<br>``` |
| **é€‚ç”¨å›¢é˜Ÿè§„æ¨¡**        | å°å‹å›¢é˜Ÿ/ä¸ªäººå¼€å‘è€…ï¼šæ•æ·å¼€å‘ã€å¿«é€ŸéªŒè¯                                           | ä¸­å¤§å‹ä¼ä¸š/äº‘åŸç”Ÿå›¢é˜Ÿï¼šé«˜å¯ç”¨ã€å¼¹æ€§æ‰©å±•éœ€æ±‚                                          |

---

### **æ€»ç»“å»ºè®®**

- **é€‰æ‹© Docker Compose çš„åœºæ™¯**ï¼š  
   - å¼€å‘/æµ‹è¯•ç¯å¢ƒå¿«é€Ÿæ­å»º  
   - å•æœåŠ¡å™¨éƒ¨ç½²è½»é‡çº§åº”ç”¨  
   - ä¸éœ€è¦å¤æ‚ç¼–æ’å’Œé«˜å¯ç”¨æ€§çš„é¡¹ç›®  

- **é€‰æ‹© Kubernetes çš„åœºæ™¯**ï¼š  
   - ç”Ÿäº§ç¯å¢ƒéœ€ä¿éšœ SLAï¼ˆå¦‚ 99.9% å¯ç”¨æ€§ï¼‰  
   - å¾®æœåŠ¡æ¶æ„ä¸‹æˆç™¾ä¸Šåƒå®¹å™¨ç®¡ç†  
   - åŠ¨æ€æ‰©ç¼©å®¹ï¼ˆå¦‚ç”µå•†ç§’æ€æµé‡é«˜å³°ï¼‰  
   - éœ€è¦å¤šç§Ÿæˆ·éš”ç¦»ã€ç²¾ç»†åŒ–æƒé™æ§åˆ¶  

- **è¿‡æ¸¡è·¯å¾„**ï¼š  
   - ä» Docker Compose è¿ç§»åˆ° K8sï¼š  
     - ä½¿ç”¨ `kompose` å·¥å…·å°† `docker-compose.yml` è½¬æ¢ä¸º Kubernetes æ¸…å•æ–‡ä»¶ã€‚  
     - ç¤ºä¾‹ï¼š  `kompose convert -f docker-compose.yml -o k8s-manifests/`